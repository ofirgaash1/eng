(function(){"use strict";const g=/(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/,p="",W="";function h(t){const[e,n,s]=t.split(":"),[r,i]=s.split(",");return Number(e)*3600*1e3+Number(n)*60*1e3+Number(r)*1e3+Number(i)}function m(t){return t.replace(/<i>/gi,p).replace(/<\/i>/gi,W).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim()}function E(t){return t.split(/\r?\n\r?\n/).filter(Boolean).map((e,n)=>{const[s,r,...i]=e.split(/\r?\n/),o=r==null?void 0:r.match(g),u=(o==null?void 0:o[1])??"00:00:00,000",c=(o==null?void 0:o[2])??"00:00:00,000",v=m(i.join(`
`));return{index:Number.parseInt(s??String(n),10),startMs:h(u),endMs:h(c),rawText:v}}).filter(e=>e.rawText.length>0)}const b=/['\u2019\u02BC](s|d)$/u,T=/['\u2019\u02BC]$/u,S=new Set(["a","e","i","o","u"]),z=["ness","ss","ous","us","is"],I=new Map([["boonies","boonie"]]);function a(t){return/[aeiouy]/u.test(t)}function l(t){return S.has(t)}function L(t){if(t.length<2)return!1;const e=t[t.length-1],n=t[t.length-2];return e===n&&!l(e)}function C(t){if(t.length<3||!t.endsWith("l"))return!1;const e=t[t.length-2],n=t[t.length-3];return e===n&&!l(e)}function R(t,e){return e||!t.endsWith("g")?!1:!t.endsWith("ng")}function $(t){if(t.length<2||!t.endsWith("k"))return!1;const e=t[t.length-2];return l(e)}function f(t){if(t.endsWith("at")||t.endsWith("bl")||t.endsWith("iz"))return`${t}e`;let e=t,n=!1;return L(e)&&!["l","s","z"].includes(e[e.length-1])&&(e=e.slice(0,-1),n=!0),C(e)?`${e}e`:R(e,n)?`${e}e`:$(e)?`${e}e`:e.endsWith("is")&&e.length>3?`${e}e`:e}function x(t){let e=t.toLowerCase().normalize("NFC");if(e=e.replace(b,""),e=e.replace(T,""),e.length<=3)return e;if(e.endsWith("ier")&&e.length>5){const n=e.slice(0,-3),s=n[n.length-1],r=n[n.length-2];if(s&&r&&s===r&&!l(s))return`${n}y`}if(e.endsWith("ied")&&e.length>3){const n=e.slice(0,-3);return e.length<=4?`${n}ie`:`${n}y`}if(e.endsWith("ies")&&e.length>3){const n=I.get(e);if(n)return n;const s=e.slice(0,-3);return e.length<=4?`${s}ie`:`${s}y`}if(e.endsWith("ing")){const n=e.slice(0,-3);if(n.length>=3&&a(n))return f(n)}if(e.endsWith("ed")){const n=e.slice(0,-2);if(n.length>=2&&a(n))return f(n)}if(e.endsWith("ly")&&e.length>4){const n=e[e.length-3];if(n&&!l(n))return e.slice(0,-2)}return e.endsWith("es")&&e.length>4?e.endsWith("ches")||e.endsWith("shes")||e.endsWith("xes")||e.endsWith("zes")?e.slice(0,-2):e.slice(0,-1):e.endsWith("s")&&e.length>4&&!z.some(n=>e.endsWith(n))?e.slice(0,-1):e}const F=new RegExp("(\\p{L}+(?:['\\u2019\\u02BC-]\\p{L}+)*)|(\\d+)|([^\\s\\p{L}\\d]+)","gu");function N(t){const e=t.replace(/[\u0001\u0002]/g,""),n=[];let s;for(;s=F.exec(e);){const[r,i,o,u]=s;if(i){const c=i.toLowerCase().normalize("NFC");n.push({text:r,normalized:c,stem:x(c),isWord:!0})}else o?n.push({text:r,normalized:o,stem:o,isWord:!1}):u&&n.push({text:r,normalized:u,stem:u,isWord:!1})}return n.length>0?n:[{text:t,normalized:t,stem:t,isWord:new RegExp("\\p{L}","u").test(t)}]}const d=self;self.addEventListener("message",t=>{const{id:e,text:n}=t.data;try{const s=E(n).map(i=>({...i,tokens:i.tokens??N(i.rawText)})),r={id:e,cues:s};d.postMessage(r)}catch(s){const r={id:e,cues:[],error:s instanceof Error?s.message:"Failed to parse subtitles"};d.postMessage(r)}})})();
