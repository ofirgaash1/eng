(function(){"use strict";const d=/(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/,p="",m="";function u(s){const[e,t,n]=s.split(":"),[r,o]=n.split(",");return Number(e)*3600*1e3+Number(t)*60*1e3+Number(r)*1e3+Number(o)}function f(s){return s.replace(/<i>/gi,p).replace(/<\/i>/gi,m).replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim()}function g(s){return s.split(/\r?\n\r?\n/).filter(Boolean).map((e,t)=>{const[n,r,...o]=e.split(/\r?\n/),i=r==null?void 0:r.match(d),c=(i==null?void 0:i[1])??"00:00:00,000",a=(i==null?void 0:i[2])??"00:00:00,000",b=f(o.join(`
`));return{index:Number.parseInt(n??String(t),10),startMs:u(c),endMs:u(a),rawText:b}}).filter(e=>e.rawText.length>0)}const T=[[/ies$/u,"y"],[/ing$/u,""],[/ed$/u,""],[/ly$/u,""],[/es$/u,"e"],[/s$/u,""]];function h(s){let e=s.toLowerCase().normalize("NFC");e=e.replace(/['’](s|d)$/u,""),e=e.replace(/['’]$/u,"");for(const[t,n]of T)if(e.length>4&&t.test(e)){if(t.source==="s$"&&(e.endsWith("ness")||e.endsWith("ss")))continue;e=e.replace(t,n);break}return e}const x=new RegExp("(\\p{L}+(?:['’-]\\p{L}+)*)|(\\d+)|([^\\s\\p{L}\\d]+)","gu");function L(s){const e=s.replace(/[\u0001\u0002]/g,""),t=[];let n;for(;n=x.exec(e);){const[r,o,i,c]=n;if(o){const a=o.toLowerCase().normalize("NFC");t.push({text:r,normalized:a,stem:h(a),isWord:!0})}else i?t.push({text:r,normalized:i,stem:i,isWord:!1}):c&&t.push({text:r,normalized:c,stem:c,isWord:!1})}return t.length>0?t:[{text:s,normalized:s,stem:s,isWord:new RegExp("\\p{L}","u").test(s)}]}const l=self;self.addEventListener("message",s=>{const{id:e,text:t}=s.data;try{const n=g(t).map(o=>({...o,tokens:o.tokens??L(o.rawText)})),r={id:e,cues:n};l.postMessage(r)}catch(n){const r={id:e,cues:[],error:n instanceof Error?n.message:"Failed to parse subtitles"};l.postMessage(r)}})})();
