(function(){"use strict";const d=/(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/;function c(t){const[e,r,s]=t.split(":"),[n,o]=s.split(",");return Number(e)*3600*1e3+Number(r)*60*1e3+Number(n)*1e3+Number(o)}function l(t){return t.split(/\r?\n\r?\n/).filter(Boolean).map((e,r)=>{const[s,n,...o]=e.split(/\r?\n/),i=n==null?void 0:n.match(d),a=(i==null?void 0:i[1])??"00:00:00,000",g=(i==null?void 0:i[2])??"00:00:00,000";return{index:Number.parseInt(s??String(r),10),startMs:c(a),endMs:c(g),rawText:o.join(` 
`)}})}const p=[[/ies$/u,"y"],[/ing$/u,""],[/ed$/u,""],[/ly$/u,""],[/es$/u,"e"],[/s$/u,""]];function m(t){let e=t.toLowerCase().normalize("NFC");for(const[r,s]of p)if(e.length>4&&r.test(e)){e=e.replace(r,s);break}return e}const f=new RegExp("(\\p{L}+(?:['â€™-]\\p{L}+)*)|(\\d+)|([^\\s\\p{L}\\d]+)","gu");function b(t){const e=[];let r;for(;r=f.exec(t);){const[s,n,o,i]=r;if(n){const a=n.toLowerCase().normalize("NFC");e.push({text:s,normalized:a,stem:m(a),isWord:!0})}else o?e.push({text:s,normalized:o,stem:o,isWord:!1}):i&&e.push({text:s,normalized:i,stem:i,isWord:!1})}return e.length>0?e:[{text:t,normalized:t,stem:t,isWord:new RegExp("\\p{L}","u").test(t)}]}const u=self;self.addEventListener("message",t=>{const{id:e,text:r}=t.data;try{const s=l(r).map(o=>({...o,tokens:o.tokens??b(o.rawText)})),n={id:e,cues:s};u.postMessage(n)}catch(s){const n={id:e,cues:[],error:s instanceof Error?s.message:"Failed to parse subtitles"};u.postMessage(n)}})})();
